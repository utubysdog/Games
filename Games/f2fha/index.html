<!DOCTYPE html>
<html lang="en-us">
	<head>
		<base href="https://cdn.statically.io/gh/slqntdevss/FTFHAPort/main/" />
		<meta charset="utf-8" />
		<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
		<meta
			name="viewport"
			content="width=device-width, height=device-height, initial-scale=1.0, minimum-scale=1.0, maximum-scale=1.0, user-scalable=no"
		/>
		<title>Unity WebGL Player | Fears To Fathom: Home Alone</title>
		<style>
			@import url("https://fonts.googleapis.com/css2?family=Inter:ital,opsz,wght@0,14..32,100..900;1,14..32,100..900&display=swap");

			* {
				margin: 0;
				padding: 0;
				border: 0;
				overflow: hidden;
			}

			body {
				background: #000;
				position: fixed;
				width: 100%;
				height: 100%;
			}

			.webgl-content {
				position: absolute;
				width: 100%;
				height: 100%;
			}

			#unityContainer {
				position: absolute;
				width: 100%;
				height: 100%;
			}

			.footer {
				position: absolute;
				bottom: 0;
				width: 100%;
				text-align: center;
				padding: 10px 0;
				background: rgba(0, 0, 0, 0.5);
				z-index: 100;
			}

			.fullscreen {
				cursor: pointer;
				display: inline-block;
				width: 24px;
				height: 24px;
			}
		</style>
		<script src="Build/UnityLoader.js"></script>
		<script>
			async function mergeFiles(fileParts, concurrency = 4) {
				const results = new Array(fileParts.length);
				let completed = 0;

				async function fetchPart(index) {
					const response = await fetch(fileParts[index]);
					const buf = await response.arrayBuffer();
					results[index] = buf;
					completed++;
					document.getElementById(
						"loading-text"
					).textContent = `Parts downloaded (${completed}/${fileParts.length})`;
				}
				let currentIndex = 0;
				async function worker() {
					while (currentIndex < fileParts.length) {
						const index = currentIndex++;
						await fetchPart(index);
					}
				}

				const workers = [];
				for (let i = 0; i < Math.min(concurrency, fileParts.length); i++) {
					workers.push(worker());
				}

				await Promise.all(workers);

				const mergedBlob = new Blob(results);
				return URL.createObjectURL(mergedBlob);
			}

			function getParts(file, start, end) {
				let parts = [];
				for (let i = start; i <= end; i++) {
					parts.push(file + ".part" + i);
				}
				return parts;
			}

			function resizeUnityContainer() {
				var container = document.getElementById("unityContainer");
				container.style.width = window.innerWidth + "px";
				container.style.height = window.innerHeight + "px";
			}
			Promise.all([
				mergeFiles(getParts("Build/FTFHAPort.data.unityweb", 1, 39)),
			]).then(([dataUrl]) => {
				window.dataUrll = dataUrl;
				var json = {
					companyName: "Rayll",
					productName: "Fears To Fathom",
					dataUrl: "FTFHAPort.data.unityweb",
					wasmCodeUrl: "FTFHAPort.wasm.code.unityweb",
					wasmFrameworkUrl: "FTFHAPort.wasm.framework.unityweb",
					TOTAL_MEMORY: 536870912,
					graphicsAPI: ["WebGL 2.0", "WebGL 1.0"],
					webglContextAttributes: { preserveDrawingBuffer: false },
					splashScreenStyle: "Dark",
					backgroundColor: "#231F20",
					cacheControl: { default: "must-revalidate" },
				};
				let blob = new Blob([JSON.stringify(json)], {
					type: "application/json",
				});
				let blobUrl = URL.createObjectURL(blob);
				window.addEventListener("resize", resizeUnityContainer);
				UnityLoader.instantiate("unityContainer", json, {
					url: blobUrl,
					Module: {
						onRuntimeInitialized: function () {
							resizeUnityContainer();
							document.querySelector("#loading-text").remove();
						},
					},
				});
			});
		</script>
	</head>

	<body>
		<div class="webgl-content">
			<div
				id="loading-text"
				style="
					color: white;
					font-family: Inter, sans-serif;
					font-size: 48px;
					text-align: center;
					margin-top: 20px;
				"
			>
				Parts downloaded (0/39)
			</div>
			<div id="unityContainer"></div>
		</div>
	</body>
</html>
