<!DOCTYPE html>
<html lang="en-us">
	<head>
		<meta charset="utf-8" />
		<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
		<title>Unity WebGL Player | Slendytubbies2</title>
		<link rel="shortcut icon" href="TemplateData/favicon.ico" />
		<link rel="stylesheet" href="TemplateData/style.css" />
	</head>
	<body>
		<div
			id="loading-text"
			style="
				color: white;
				font-family: Inter, sans-serif;
				font-size: 48px;
				text-align: center;
				margin-top: 20px;
			"
		>
			Parts downloaded (0/3)
		</div>
		<div id="unity-container" class="unity-desktop">
			<canvas id="unity-canvas" width="960" height="600" tabindex="-1"></canvas>
			<div id="unity-loading-bar">
				<div id="unity-logo"></div>
				<div id="unity-progress-bar-empty">
					<div id="unity-progress-bar-full"></div>
				</div>
			</div>

			<div id="unity-warning"></div>
			<div id="unity-footer">
				<div id="unity-webgl-logo"></div>
				<div id="unity-fullscreen-button"></div>
				<div id="unity-build-title">Slendytubbies2</div>
			</div>
		</div>
		<script>
			var container = document.querySelector("#unity-container");
			var canvas = document.querySelector("#unity-canvas");
			var loadingBar = document.querySelector("#unity-loading-bar");
			var progressBarFull = document.querySelector("#unity-progress-bar-full");
			var fullscreenButton = document.querySelector("#unity-fullscreen-button");
			var warningBanner = document.querySelector("#unity-warning");

			function unityShowBanner(msg, type) {}

			function mergeFiles(fileParts) {
				return new Promise((resolve, reject) => {
					let buffers = [];

					function fetchPart(index) {
						if (index >= fileParts.length) {
							let mergedBlob = new Blob(buffers);
							let mergedFileUrl = URL.createObjectURL(mergedBlob);
							resolve(mergedFileUrl);
							return;
						}
						fetch(fileParts[index])
							.then((response) => response.arrayBuffer())
							.then((data) => {
								buffers.push(data);
								document.getElementById(
									"loading-text"
								).textContent = `Parts downloaded (${index + 1}/3)`;
								fetchPart(index + 1);
							})
							.catch(reject);
					}
					fetchPart(0);
				});
			}

			function getParts(file, start, end) {
				let parts = [];
				for (let i = start; i <= end; i++) {
					parts.push(file + ".part" + i);
				}
				return parts;
			}
			Promise.all([
				mergeFiles(getParts("Build/BuilderRuilder.data", 1, 3)),
			]).then(([dataUrl]) => {
				container.hidden = false;
				var buildUrl = "Build";
				var loaderUrl = buildUrl + "/BuilderRuilder.loader.js";
				var config = {
					dataUrl: dataUrl,
					frameworkUrl: buildUrl + "/BuilderRuilder.framework.js",
					codeUrl: buildUrl + "/BuilderRuilder.wasm",
					streamingAssetsUrl: "StreamingAssets",
					companyName: "KAIDENSARCADE",
					productName: "Slendytubbies2",
					productVersion: "0.3",
					showBanner: unityShowBanner,
				};
				if (/iPhone|iPad|iPod|Android/i.test(navigator.userAgent)) {
					var meta = document.createElement("meta");
					meta.name = "viewport";
					meta.content =
						"width=device-width, height=device-height, initial-scale=1.0, user-scalable=no, shrink-to-fit=yes";
					document.getElementsByTagName("head")[0].appendChild(meta);
					container.className = "unity-mobile";
					canvas.className = "unity-mobile";
				} else {
					function resizeCanvas() {
						canvas.width = window.innerWidth;
						canvas.height = window.innerHeight;
						canvas.style.width = window.innerWidth + "px";
						canvas.style.height = window.innerHeight + "px";
					}
					resizeCanvas();
					window.addEventListener("resize", resizeCanvas);
				}
				loadingBar.style.display = "block";
				var script = document.createElement("script");
				script.src = loaderUrl;
				script.onload = () => {
					createUnityInstance(canvas, config, (progress) => {
						progressBarFull.style.width = 100 * progress + "%";
					})
						.then((unityInstance) => {
							loadingBar.style.display = "none";
							document.querySelector("#loading-text").remove();
						})
						.catch((message) => {
							alert(message);
						});
				};
				document.body.appendChild(script);
			});
		</script>
	</body>
</html>
